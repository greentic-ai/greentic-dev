{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://greentic-ai.github.io/greentic-component/schemas/v1/component.manifest.schema.json",
  "title": "Greentic Component Manifest v1",
  "type": "object",
  "additionalProperties": false,
  "required": [
    "id",
    "name",
    "version",
    "world",
    "describe_export",
    "supports",
    "profiles",
    "capabilities",
    "artifacts",
    "hashes"
  ],
  "properties": {
    "$schema": {
      "type": "string",
      "description": "Optional JSON Schema reference for tooling"
    },
    "id": {
      "type": "string",
      "minLength": 1,
      "description": "Opaque component identifier"
    },
    "name": {
      "type": "string",
      "minLength": 1
    },
    "version": {
      "type": "string",
      "pattern": "^[0-9]+\\.[0-9]+\\.[0-9]+(?:[-+][A-Za-z0-9\\.-]+)?$"
    },
    "world": {
      "type": "string",
      "minLength": 1
    },
    "describe_export": {
      "type": "string",
      "minLength": 1
    },
    "supports": {
      "type": "array",
      "minItems": 1,
      "items": {
        "type": "string",
        "enum": ["messaging", "event", "component_config", "job", "http"]
      }
    },
    "profiles": {
      "type": "object",
      "additionalProperties": false,
      "required": ["supported"],
      "properties": {
        "default": {
          "type": "string",
          "minLength": 1
        },
        "supported": {
          "type": "array",
          "minItems": 1,
          "items": {
            "type": "string",
            "minLength": 1
          }
        }
      }
    },
    "capabilities": {
      "type": "object",
      "additionalProperties": false,
      "required": ["wasi", "host"],
      "properties": {
        "wasi": {
          "type": "object",
          "additionalProperties": false,
          "properties": {
            "filesystem": {
              "type": "object",
              "additionalProperties": false,
              "required": ["mode"],
              "properties": {
                "mode": {
                  "type": "string",
                  "enum": ["none", "read_only", "sandbox"]
                },
                "mounts": {
                  "type": "array",
                  "items": {
                    "type": "object",
                    "additionalProperties": false,
                    "required": ["name", "host_class", "guest_path"],
                    "properties": {
                      "name": {
                        "type": "string",
                        "minLength": 1
                      },
                      "host_class": {
                        "type": "string",
                        "minLength": 1
                      },
                      "guest_path": {
                        "type": "string",
                        "minLength": 1
                      }
                    }
                  }
                }
              }
            },
            "env": {
              "type": "object",
              "additionalProperties": false,
              "properties": {
                "allow": {
                  "type": "array",
                  "items": {
                    "type": "string",
                    "minLength": 1
                  }
                }
              }
            },
            "random": {
              "type": "boolean",
              "default": false
            },
            "clocks": {
              "type": "boolean",
              "default": false
            }
          }
        },
        "host": {
          "type": "object",
          "additionalProperties": false,
          "properties": {
            "secrets": {
              "type": "object",
              "additionalProperties": false,
              "properties": {
                "required": {
                  "type": "array",
                  "items": {
                    "type": "string",
                    "minLength": 1
                  }
                }
              }
            },
            "state": {
              "type": "object",
              "additionalProperties": false,
              "properties": {
                "read": {
                  "type": "boolean",
                  "default": false
                },
                "write": {
                  "type": "boolean",
                  "default": false
                }
              }
            },
            "messaging": {
              "type": "object",
              "additionalProperties": false,
              "properties": {
                "inbound": {
                  "type": "boolean",
                  "default": false
                },
                "outbound": {
                  "type": "boolean",
                  "default": false
                }
              }
            },
            "events": {
              "type": "object",
              "additionalProperties": false,
              "properties": {
                "inbound": {
                  "type": "boolean",
                  "default": false
                },
                "outbound": {
                  "type": "boolean",
                  "default": false
                }
              }
            },
            "http": {
              "type": "object",
              "additionalProperties": false,
              "properties": {
                "client": {
                  "type": "boolean",
                  "default": false
                },
                "server": {
                  "type": "boolean",
                  "default": false
                }
              }
            },
            "telemetry": {
              "type": "object",
              "additionalProperties": false,
              "properties": {
                "scope": {
                  "type": "string",
                  "enum": ["tenant", "pack", "node"]
                }
              }
            },
            "iac": {
              "type": "object",
              "additionalProperties": false,
              "properties": {
                "write_templates": {
                  "type": "boolean",
                  "default": false
                },
                "execute_plans": {
                  "type": "boolean",
                  "default": false
                }
              }
            }
          }
        }
      }
    },
    "configurators": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "basic": {
          "type": "string",
          "minLength": 1
        },
        "full": {
          "type": "string",
          "minLength": 1
        }
      }
    },
    "limits": {
      "type": "object",
      "additionalProperties": false,
      "required": ["memory_mb", "wall_time_ms"],
      "properties": {
        "memory_mb": {
          "type": "integer",
          "minimum": 1
        },
        "wall_time_ms": {
          "type": "integer",
          "minimum": 1
        },
        "fuel": {
          "type": "integer",
          "minimum": 0
        },
        "files": {
          "type": "integer",
          "minimum": 0
        }
      }
    },
    "telemetry": {
      "type": "object",
      "additionalProperties": false,
      "required": ["span_prefix"],
      "properties": {
        "span_prefix": {
          "type": "string",
          "minLength": 1,
          "x-default-applied": "provider_scope"
        },
        "attributes": {
          "type": "object",
          "x-redact": false,
          "additionalProperties": {
            "type": "string"
          }
        },
        "emit_node_spans": {
          "type": "boolean",
          "default": true
        }
      }
    },
    "provenance": {
      "type": "object",
      "additionalProperties": false,
      "required": ["builder", "git_commit", "toolchain", "built_at_utc"],
      "properties": {
        "builder": {
          "type": "string",
          "minLength": 1
        },
        "git_commit": {
          "type": "string",
          "minLength": 7
        },
        "toolchain": {
          "type": "string",
          "minLength": 1
        },
        "built_at_utc": {
          "type": "string",
          "format": "date-time"
        }
      }
    },
    "artifacts": {
      "type": "object",
      "additionalProperties": false,
      "required": ["component_wasm"],
      "properties": {
        "component_wasm": {
          "type": "string",
          "minLength": 1
        }
      }
    },
    "hashes": {
      "type": "object",
      "additionalProperties": false,
      "required": ["component_wasm"],
      "properties": {
        "component_wasm": {
          "type": "string",
          "pattern": "^blake3:[0-9a-fA-F]{64}$",
          "x-capability": "signing"
        }
      }
    },
    "dev_flows": {
      "type": "object",
      "additionalProperties": {
        "type": "object",
        "additionalProperties": false,
        "properties": {
          "format": {
            "type": "string",
            "enum": ["flow-ir-json"],
            "default": "flow-ir-json"
          },
          "graph": {
            "type": "object",
            "description": "FlowIR JSON graph"
          }
        },
        "required": ["graph"]
      }
    }
  }
}
